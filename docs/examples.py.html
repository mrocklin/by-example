<!DOCTYPE html>

<html>
<head>
  <title>Setup</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="setup">Setup</h1>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>We set up a center on one node</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>$ dcenter
Start center at <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">8787</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>And set up workers on other processes or computers that point to this address</p>
<p>For simplicity we used localhost here (<code>127.0.0.1</code>) but we could have used
other machines and real addresses if desired.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>$ dworker <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">8787</span>
Start worker at             <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">46990</span>
Registered <span class="hljs-keyword">with</span> center at:  <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">8787</span>

$ dworker <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">8787</span>
Start worker at             <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">46990</span>
Registered <span class="hljs-keyword">with</span> center at:  <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">8787</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h1 id="executor">Executor</h1>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>We connect an executor to the center node of our cluster</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">from</span> distributed <span class="hljs-keyword">import</span> Executor
e = Executor(<span class="hljs-string">'127.0.0.1:8787'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h1 id="submit-and-result">Submit and Result</h1>

            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>We submit a function for remote execution and receive a future.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">inc</span><span class="hljs-params">(x)</span>:</span>
    <span class="hljs-keyword">return</span> x + <span class="hljs-number">1</span>

<span class="hljs-meta">&gt;&gt;&gt; </span>future = e.submit(inc, <span class="hljs-number">1</span>)  <span class="hljs-comment"># calls inc(1) on a worker</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>The future isn’t the actual result (2).  It points to that result on a remote
worker.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-meta">&gt;&gt;&gt; </span>future
&lt;Future: status: finished, key: inc<span class="hljs-number">-79963</span>f7e613e5e55838d2232920baed2&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>We collect the remote result from the remote worker to the local process by
calling <code>result()</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-meta">&gt;&gt;&gt; </span>future.result()  <span class="hljs-comment"># collect result from remote worker</span>
<span class="hljs-number">2</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h1 id="map-and-gather">map and gather</h1>

            </div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>We apply the same function to many inputs with map</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-meta">&gt;&gt;&gt; </span>futures = e.map(inc, range(<span class="hljs-number">5</span>))  <span class="hljs-comment"># calls inc(0), inc(1), inc(2), ...</span>
<span class="hljs-meta">&gt;&gt;&gt; </span>futures
[&lt;Future: status: finished, key: inc-dd870045da2e4a018bd1f00a85a3fca1&gt;,
 &lt;Future: status: finished, key: inc<span class="hljs-number">-79963</span>f7e613e5e55838d2232920baed2&gt;,
 &lt;Future: status: finished, key: inc<span class="hljs-number">-4</span>f805cf88530097292a3bbfd148172f5&gt;,
 &lt;Future: status: finished, key: inc<span class="hljs-number">-8</span>d6eb486f5d44cf3484056b8066c0185&gt;,
 &lt;Future: status: finished, key: inc<span class="hljs-number">-8</span>efcc563abc786b74d7003c06b8ae7b7&gt;]</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>We collect all of the results with a single call to gather</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-meta">&gt;&gt;&gt; </span>e.gather(futures)  <span class="hljs-comment"># collect remote data to local process</span>
[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <h1 id="submit-and-map-on-futures">Submit and map on futures</h1>

            </div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>We <code>submit</code> and <code>map</code> functions directly onto futures.</p>
<p>We don’t need to collect the intermediate result, <code>future</code>, to the local
process.  This avoids sending large remote results across the network.  We move
the function to the data rather than move the data to the function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">inc</span><span class="hljs-params">(x)</span>:</span>
    <span class="hljs-keyword">return</span> x + <span class="hljs-number">1</span>

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">double</span><span class="hljs-params">(x)</span>:</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">2</span> * x

future = e.submit(inc, <span class="hljs-number">1</span>)
future2 = e.submit(double, future)</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>You should avoid data-movement operations like <code>future.result()</code> or <code>e.gather()</code> when possible</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-comment"># future.result()  # no need to move the intermediate result</span></pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>We make sure to move the function to the worker node that already has the data
for the input.  This minimizes communication within the network.</p>
<h1 id="submit-and-map-with-many-inputs">Submit and map with many inputs</h1>

            </div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Submit and map can take multiple inputs:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-meta">&gt;&gt;&gt; </span>e.submit(function, *args, **kwargs)
<span class="hljs-meta">&gt;&gt;&gt; </span>e.map(function, *iterables, **kwargs)</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>This includes taking in multiple futures</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-meta">&gt;&gt;&gt; </span>futures = e.map(double, range(<span class="hljs-number">10</span>))
<span class="hljs-meta">&gt;&gt;&gt; </span>total = e.submit(sum, futures)   <span class="hljs-comment"># call sum on a list of futures</span>
<span class="hljs-meta">&gt;&gt;&gt; </span>total.result()
<span class="hljs-number">90</span></pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>If the remote data inputs live on different worker nodes then we move all of
the data to a single node to run the function.  Generally we run the
computation on the node that has most of the bytes of the input data.</p>
<h1 id="scatter">Scatter</h1>

            </div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>We send local data to the network with the <code>scatter</code> function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-meta">&gt;&gt;&gt; </span>e.scatter([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>])
[&lt;Future: status: finished, key: <span class="hljs-number">526</span>d1868-a5a1<span class="hljs-number">-11e5</span><span class="hljs-number">-901</span>d<span class="hljs-number">-60672020</span>cfac<span class="hljs-number">-0</span>&gt;,
 &lt;Future: status: finished, key: <span class="hljs-number">526</span>d1868-a5a1<span class="hljs-number">-11e5</span><span class="hljs-number">-901</span>d<span class="hljs-number">-60672020</span>cfac<span class="hljs-number">-1</span>&gt;,
 &lt;Future: status: finished, key: <span class="hljs-number">526</span>d1868-a5a1<span class="hljs-number">-11e5</span><span class="hljs-number">-901</span>d<span class="hljs-number">-60672020</span>cfac<span class="hljs-number">-2</span>&gt;]</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>This is particularly common when we have data on our local disk that we want to
load and then send up to the network</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> glob <span class="hljs-keyword">import</span> glob
<span class="hljs-meta">&gt;&gt;&gt; </span>filenames = glob(<span class="hljs-string">'2015-*-*.csv'</span>)

<span class="hljs-meta">&gt;&gt;&gt; </span>futures = []
<span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">for</span> fn <span class="hljs-keyword">in</span> filenames:
<span class="hljs-meta">... </span>    df = pd.read_csv(fn, parse_dates=[<span class="hljs-string">'date'</span>])
<span class="hljs-meta">... </span>    futures.extend(e.scatter([df]))</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>But its best to use the workers themselves to load the data if the data is
globally available (such as on a network file system).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-meta">&gt;&gt;&gt; </span>filename_futures = e.scatter(filenames)
<span class="hljs-meta">&gt;&gt;&gt; </span>futures = e.map(pd.read_csv, filename_futures, parse_dates=[<span class="hljs-string">'date'</span>])</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
